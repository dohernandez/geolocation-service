language: go

sudo: false

go:
- 1.12.x

branches:
  only:
  - master
  - /(^|[-\/])(major|release|minor|feature|patch|issue|hotfix)[-\/]?/

env:
  global:
  - GITHUB_OWNER=$(echo ${TRAVIS_REPO_SLUG} | cut -d"/" -f1)
  - GITHUB_REPO=$(echo ${TRAVIS_REPO_SLUG} | cut -d"/" -f2)
  - BINARY_NAME=${GITHUB_REPO}
  - VERSION=$(eval ./ci/version.sh)

stages:
- "Code Style"
- "Unit Tests"
- "Promote Docker Image"

jobs:
  include:
  - stage: "Code Style"
    install: skip
    script: ci/code-style.sh
    if: branch = master || type = pull_request

  - stage: "Unit Tests"
    install: skip
    script: ci/unit-tests.sh
    if: branch = master || type = pull_request

  - stage: "Promote Docker Image"
    install: ci/bump-version.sh
    script: ci/promote-docker-image.sh
    if: branch = master && type != pull_request
